
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Search Algorithms &#8212; Archai</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/tabs.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Config Search Spaces" href="config_search.html" />
    <link rel="prev" title="Evaluators" href="evaluators.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../package_structure.html">
   Package Structure
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../quick_start.html">
   Quick Start
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../notebooks.html">
   Notebooks
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api.html">
     API
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/dataset_provider.html">
       Dataset Provider
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/trainer_base.html">
       Trainer (Base)
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../discrete_search.html">
     Discrete Search
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="search_space.html">
       Search Spaces
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="evaluators.html">
       Evaluators
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Algorithms
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="config_search.html">
       Configuration-based Search
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../supergraph.html">
     Supergraph
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../cv.html">
     Computer Vision
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../cv/cv_dataset_provider.html">
       Dataset Provider
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../cv/pl_trainer.html">
       PyTorch-Lightining Trainer
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../nlp.html">
     Natural Language Processing
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../nlp/hf_dataset_provider.html">
       HF Dataset Provider
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../nlp/hf_trainer.html">
       HF Trainer
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../nlp/nvidia_dataset_provider.html">
       NVIDIA Dataset Provider
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../nlp/nvidia_trainer.html">
       NVIDIA Trainer
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../nlp/onnx_export.html">
       ONNX Export
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../nlp/torch_quantization.html">
       PyTorch Quantization
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Advanced Guide
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../advanced_guide/nas.html">
   Neural Architecture Search
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/nas/discrete_search.html">
     Discrete Search
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/nas/supergraph.html">
     Supergraph
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../advanced_guide/cv.html">
   Computer Vision
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/cv/datasets.html">
     Datasets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/cv/trainers.html">
     Trainers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/cv/onnx.html">
     ONNX
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/cv/quantization.html">
     Quantization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../advanced_guide/nlp.html">
   Natural Language Processing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/nlp/datasets.html">
     Datasets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/nlp/trainers.html">
     Trainers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/nlp/onnx.html">
     ONNX
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/nlp/quantization.html">
     Quantization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../advanced_guide/cloud.html">
   Cloud-Based Search
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../advanced_guide/cloud/azure.html">
     Azure
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contributing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../contributing/first_contribution.html">
   First Time Contributor
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../contributing/documentation.html">
   Documentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../contributing/unitary_tests.html">
   Unitary Tests
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Support
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../support/faq.html">
   Frequently Asked Questions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../support/contact.html">
   Contact
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../support/copyright.html">
   Copyright
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../reference/api.html">
   API
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../reference/api/archai.api.html">
     API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../reference/api/archai.common.html">
     Common Packages
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../reference/api/archai.datasets.html">
     Datasets
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
    <label for="toctree-checkbox-11">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../reference/api/archai.datasets.cv.html">
       Computer Vision
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
      <label for="toctree-checkbox-12">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.datasets.cv.transforms.html">
         Transforms
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../reference/api/archai.datasets.nlp.html">
       Natural Language Processing
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
      <label for="toctree-checkbox-13">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.datasets.nlp.tokenizer_utils.html">
         Tokenization Utilities
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../reference/api/archai.discrete_search.html">
     Discrete Search
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
    <label for="toctree-checkbox-14">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.discrete_search.algos.html">
       Search Algorithms
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.discrete_search.api.html">
       API
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../reference/api/archai.discrete_search.evaluators.html">
       Evaluators
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
      <label for="toctree-checkbox-15">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.discrete_search.evaluators.nlp.html">
         Natural Language Processing
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.discrete_search.evaluators.pt_profiler_utils.html">
         PyTorch Profiler (Utilities)
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.discrete_search.predictors.html">
       Predictors
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../reference/api/archai.discrete_search.search_spaces.html">
       Search Spaces
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
      <label for="toctree-checkbox-16">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.discrete_search.search_spaces.config.html">
         Configuration-Based
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.discrete_search.search_spaces.natsbench_tss.html">
         NATS-Bench
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.discrete_search.search_spaces.nlp.html">
         Natural Language Processing
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.discrete_search.search_spaces.segmentation_dag.html">
         Segmentation DAG
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.discrete_search.utils.html">
       Utilities
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../reference/api/archai.onnx.html">
     ONNX
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
    <label for="toctree-checkbox-17">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.onnx.config_utils.html">
       Configuration Utilities
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.onnx.optimization_utils.html">
       Optimization Utilities
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../reference/api/archai.quantization.html">
     Quantization
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
    <label for="toctree-checkbox-18">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.quantization.nlp.html">
       Natural Language Processing
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../reference/api/archai.supergraph.html">
     Supergraph
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
    <label for="toctree-checkbox-19">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../reference/api/archai.supergraph.algos.html">
       Algorithms
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
      <label for="toctree-checkbox-20">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.supergraph.algos.darts.html">
         DARTS
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.supergraph.algos.didarts.html">
         DiDARTS
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.supergraph.algos.divnas.html">
         DivNAS
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.supergraph.algos.gumbelsoftmax.html">
         Gumbel-Softmax
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.supergraph.algos.manual.html">
         Manual
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.supergraph.algos.nasbench101.html">
         NasBench-101
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.supergraph.algos.petridish.html">
         Petridish
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.supergraph.algos.random.html">
         Random
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.supergraph.algos.xnas.html">
         XNAS
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../reference/api/archai.supergraph.datasets.html">
       Datasets
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
      <label for="toctree-checkbox-21">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.supergraph.datasets.providers.html">
         Providers
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../../reference/api/archai.supergraph.models.html">
       Models
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
      <label for="toctree-checkbox-22">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../../reference/api/archai.supergraph.models.shakeshake.html">
         ShakeShake
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.supergraph.nas.html">
       Neural Architecture Search
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.supergraph.utils.html">
       Utilities
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../reference/api/archai.trainers.html">
     Trainers
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
    <label for="toctree-checkbox-23">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.trainers.cv.html">
       Computer Vision
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../reference/api/archai.trainers.nlp.html">
       Natural Language Processing
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../reference/roadmap.html">
   Roadmap
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../reference/changelog.html">
   Changelog
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/microsoft/archai"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/microsoft/archai/issues/new?title=Issue%20on%20page%20%2Fgetting_started/notebooks/discrete_search/algos.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/microsoft/archai/edit/master/getting_started/notebooks/discrete_search/algos.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Sections
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Dataset-Provider">
   Dataset Provider
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Wrapping-custom-evaluation-code">
   Wrapping custom evaluation code
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Defining-Search-Objectives">
   Defining Search Objectives
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Adding-objectives">
     Adding objectives
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Adding-extra-constraints">
     Adding extra constraints
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Using-a-search-algorithm">
   Using a search algorithm
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Example:-EvolutionParetoSearch">
     Example:
     <code class="docutils literal notranslate">
      <span class="pre">
       EvolutionParetoSearch
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Search Algorithms</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Sections </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Dataset-Provider">
   Dataset Provider
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Wrapping-custom-evaluation-code">
   Wrapping custom evaluation code
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Defining-Search-Objectives">
   Defining Search Objectives
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Adding-objectives">
     Adding objectives
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Adding-extra-constraints">
     Adding extra constraints
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Using-a-search-algorithm">
   Using a search algorithm
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Example:-EvolutionParetoSearch">
     Example:
     <code class="docutils literal notranslate">
      <span class="pre">
       EvolutionParetoSearch
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Search-Algorithms">
<h1>Search Algorithms<a class="headerlink" href="#Search-Algorithms" title="Permalink to this headline">#</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">overrides</span> <span class="kn">import</span> <span class="n">overrides</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">Random</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">archai.discrete_search.api.archai_model</span> <span class="kn">import</span> <span class="n">ArchaiModel</span>
<span class="kn">from</span> <span class="nn">archai.discrete_search.api.search_space</span> <span class="kn">import</span> <span class="n">EvolutionarySearchSpace</span><span class="p">,</span> <span class="n">BayesOptSearchSpace</span>
</pre></div>
</div>
</div>
<p>We will re-use the CNN search space created in the <a class="reference internal" href="search_space.html"><span class="doc">search space example</span></a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span> <span class="o">=</span> <span class="n">CNNSearchSpace</span><span class="p">(</span><span class="n">max_layers</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">kernel_list</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="n">hidden_list</span><span class="o">=</span><span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span>
<span class="n">m</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ArchaiModel(
        archid=(3, 7, 32),
        metadata={},
        arch=MyModel(
  (model): Sequential(
    (0): Conv2d(1, 32, kernel_size=(7, 7), stride=(1, 1), padding=(3, 3))
    (1): BatchNorm2d(32, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (2): ReLU()
    (3): Conv2d(32, 32, kernel_size=(7, 7), stride=(1, 1), padding=(3, 3))
    (4): BatchNorm2d(32, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (5): ReLU()
    (6): Conv2d(32, 32, kernel_size=(7, 7), stride=(1, 1), padding=(3, 3))
    (7): BatchNorm2d(32, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (8): ReLU()
    (9): AdaptiveAvgPool2d(output_size=(1, 1))
    (10): Conv2d(32, 10, kernel_size=(1, 1), stride=(1, 1))
  )
)
)
</pre></div></div>
</div>
<section id="Dataset-Provider">
<h2>Dataset Provider<a class="headerlink" href="#Dataset-Provider" title="Permalink to this headline">#</a></h2>
<p>Datasets are represented in Archai throught the <code class="docutils literal notranslate"><span class="pre">`DatasetProvider</span></code> &lt;../../reference/api/archai.discrete_search.api.rst&gt;`__ class. For this example, we will use the built-in dataset provider of the MNIST dataset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">archai.datasets.cv.mnist_dataset_provider</span> <span class="kn">import</span> <span class="n">MnistDatasetProvider</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset_provider</span> <span class="o">=</span> <span class="n">MnistDatasetProvider</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>We can get train/test PyTorch datasets from a DatasetProvider by calling <code class="docutils literal notranslate"><span class="pre">dataset_provider.get_datasets(load_train,</span> <span class="pre">load_test,</span> <span class="pre">transforms_train,</span> <span class="pre">transforms_test)</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loads only the training set</span>
<span class="n">tr_d</span> <span class="o">=</span> <span class="n">dataset_provider</span><span class="o">.</span><span class="n">get_train_dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Wrapping-custom-evaluation-code">
<h2>Wrapping custom evaluation code<a class="headerlink" href="#Wrapping-custom-evaluation-code" title="Permalink to this headline">#</a></h2>
<p>We will evaluate our models using partial trainig validation accuracy as a proxy for final task performance.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">archai.discrete_search.api.model_evaluator</span> <span class="kn">import</span> <span class="n">ModelEvaluator</span>
<span class="kn">from</span> <span class="nn">archai.discrete_search.evaluators.ray</span> <span class="kn">import</span> <span class="n">RayParallelEvaluator</span>

<span class="kn">from</span> <span class="nn">torchvision.transforms</span> <span class="kn">import</span> <span class="n">Compose</span><span class="p">,</span> <span class="n">ToTensor</span><span class="p">,</span> <span class="n">Normalize</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">math</span>


<span class="k">class</span> <span class="nc">PartialTrainingValAccuracy</span><span class="p">(</span><span class="n">ModelEvaluator</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">training_epochs</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;cpu&#39;</span><span class="p">,</span>
                 <span class="n">progress_bar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">training_epochs</span> <span class="o">=</span> <span class="n">training_epochs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">=</span> <span class="n">lr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span> <span class="o">=</span> <span class="n">progress_bar</span>

    <span class="nd">@overrides</span>
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">dataset_provider</span><span class="p">,</span> <span class="n">budget</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="c1"># Loads the dataset</span>
        <span class="n">tr_data</span> <span class="o">=</span> <span class="n">dataset_provider</span><span class="o">.</span><span class="n">get_train_dataset</span><span class="p">()</span>

        <span class="c1"># Train-validation split</span>
        <span class="n">tr_data</span><span class="p">,</span> <span class="n">val_data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">random_split</span><span class="p">(</span>
            <span class="n">tr_data</span><span class="p">,</span> <span class="n">lengths</span><span class="o">=</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tr_data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1_000</span><span class="p">,</span> <span class="mi">1_000</span><span class="p">],</span>
            <span class="n">generator</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">Generator</span><span class="p">()</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">tr_dl</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">tr_data</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">val_dl</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">val_data</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="c1"># Training settings</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lr</span><span class="p">)</span>
        <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>

        <span class="n">model</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

        <span class="c1"># Partial training</span>
        <span class="n">epoch_iter</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">training_epochs</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span><span class="p">:</span>
            <span class="n">epoch_iter</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">epoch_iter</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Training model </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">archid</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">epoch_nb</span> <span class="ow">in</span> <span class="n">epoch_iter</span><span class="p">:</span>
            <span class="c1"># Early stops for fractional values of training epochs (e.g, 0.2)</span>
            <span class="n">early_stop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tr_dl</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">training_epochs</span> <span class="o">-</span> <span class="n">epoch_nb</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">early_stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">training_epochs</span> <span class="o">-</span> <span class="n">epoch_nb</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">tr_dl</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tr_dl</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">early_stop</span><span class="p">:</span>
                    <span class="k">break</span>

                <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>

                <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">arch</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>
                <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>

                <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
                <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

        <span class="c1"># Evaluates final model</span>
        <span class="n">model</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="n">val_pred</span><span class="p">,</span> <span class="n">val_target</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">val_dl</span><span class="p">:</span>
                <span class="n">val_pred</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">arch</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">))</span>
                <span class="n">val_target</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">))</span>

            <span class="n">val_pred</span><span class="p">,</span> <span class="n">val_target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">val_pred</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">val_target</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">val_acc</span> <span class="o">=</span> <span class="p">(</span><span class="n">val_pred</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span> <span class="o">==</span> <span class="n">val_target</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="c1"># Returns model to cpu</span>
        <span class="n">model</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">val_acc</span>
</pre></div>
</div>
</div>
<p>Lets test our evaluator:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">partial_tr</span> <span class="o">=</span> <span class="n">PartialTrainingValAccuracy</span><span class="p">(</span><span class="n">training_epochs</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">partial_tr</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(),</span> <span class="n">dataset_provider</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Training model (5, 3, 64): 100%|| 1/1 [00:00&lt;00:00,  2.49it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.088
</pre></div></div>
</div>
<p>We can make this objective more efficient evaluating multiple architectures in parallel. To do that, we can use the <code class="docutils literal notranslate"><span class="pre">RayParallelObjective</span></code> wrapper mentioned in the <a class="reference internal" href="evaluators.html"><span class="doc">previous example</span></a>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parallel_partial_tr</span> <span class="o">=</span> <span class="n">RayParallelEvaluator</span><span class="p">(</span><span class="n">partial_tr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Lets test our partial training objective sending two random architectures</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_SKIP</span>
<span class="n">parallel_partial_tr</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(),</span> <span class="n">dataset_provider</span><span class="p">)</span>
<span class="n">parallel_partial_tr</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(),</span> <span class="n">dataset_provider</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2023-01-10 16:51:28,677 INFO worker.py:1518 -- Started a local Ray instance.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_SKIP</span>
<span class="n">parallel_partial_tr</span><span class="o">.</span><span class="n">fetch_all</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Training model (7, 3, 32):   0%|          | 0/1 [00:00&lt;?, ?it/s]
Training model (8, 5, 128):   0%|          | 0/1 [00:00&lt;?, ?it/s]
Training model (7, 3, 32): 100%|| 1/1 [00:00&lt;00:00,  2.64it/s]
Training model (8, 5, 128): 100%|| 1/1 [00:07&lt;00:00,  7.10s/it]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0.088, 0.088]
</pre></div></div>
</div>
<p>To run the same objective distributing jobs across multiple GPUs, just set the <code class="docutils literal notranslate"><span class="pre">num_gpus</span></code> parameter from <a class="reference external" href="https://docs.ray.io/en/latest/ray-core/package-ref.html#ray-init">ray.init</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RayParallelObjective</span><span class="p">(</span>
    <span class="n">PartialTrainingValAccuracy</span><span class="p">(</span><span class="n">training_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">num_gpus</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="c1"># 2 jobs per gpu available</span>
    <span class="n">max_calls</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="Defining-Search-Objectives">
<h2>Defining Search Objectives<a class="headerlink" href="#Defining-Search-Objectives" title="Permalink to this headline">#</a></h2>
<p>Search optimization objectives are specified using the <code class="docutils literal notranslate"><span class="pre">archai.discrete_search.SearchObjectives</span></code> class</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">archai.discrete_search.api.search_objectives</span> <span class="kn">import</span> <span class="n">SearchObjectives</span>

<span class="n">objectives</span> <span class="o">=</span> <span class="n">SearchObjectives</span><span class="p">()</span>
</pre></div>
</div>
</div>
<section id="Adding-objectives">
<h3>Adding objectives<a class="headerlink" href="#Adding-objectives" title="Permalink to this headline">#</a></h3>
<p>To add search objectives, we can use the <code class="docutils literal notranslate"><span class="pre">SearchObjectives.add_objective</span></code> method</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">archai.discrete_search.evaluators.onnx_model</span> <span class="kn">import</span> <span class="n">AvgOnnxLatency</span>
<span class="kn">from</span> <span class="nn">archai.discrete_search.evaluators.pt_profiler</span> <span class="kn">import</span> <span class="n">TorchFlops</span><span class="p">,</span> <span class="n">TorchNumParameters</span>

<span class="n">objectives</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span>
    <span class="c1"># This name will be used in plots and reports</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ONNX Latency (ms)&#39;</span><span class="p">,</span>

    <span class="c1"># This is the evaluator we want to use</span>
    <span class="n">model_evaluator</span><span class="o">=</span><span class="n">AvgOnnxLatency</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span> <span class="n">num_trials</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>

    <span class="c1"># Optimization direction. `True` for maximization or `False` for minimization</span>
    <span class="n">higher_is_better</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>

    <span class="c1"># Used to sinalized if this evaluator is compute intensive.</span>
    <span class="n">compute_intensive</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<br/></pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">compute_intensive</span></code> flag is used in some search algorithms to help increase search efficiency. For instance, search algorithms that use surrogate models may try to estimate the value of expensive objective functions of unseen architectures in certain situations, while cheap objectives (<code class="docutils literal notranslate"><span class="pre">compute_intensive=False</span></code>) will just be computed directly.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">objectives</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span>
    <span class="s1">&#39;FLOPs&#39;</span><span class="p">,</span> <span class="n">TorchFlops</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)),</span>
    <span class="n">higher_is_better</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">compute_intensive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="c1"># We may optionally add a constraint.</span>
    <span class="c1"># Architectures outside this range will be ignored by the search algorithm</span>
    <span class="n">constraint</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1e9</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Additionally, objectives that are cheap to evaluate (<code class="docutils literal notranslate"><span class="pre">compute_intensive=False</span></code>) may receive an optional <code class="docutils literal notranslate"><span class="pre">constraint</span></code> argument. Model candidates outside this range will be ignored by the search algorithm.</p>
<p>We can evaluate cheap objectives calling <code class="docutils literal notranslate"><span class="pre">SearchObjectives.eval_cheap_objs(model_list,</span> <span class="pre">dataset_providers)</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">objectives</span><span class="o">.</span><span class="n">eval_cheap_objs</span><span class="p">([</span><span class="n">ss</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)],</span> <span class="n">dataset_providers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Calculating &#34;ONNX Latency (ms)&#34;...: 100%|| 2/2 [00:00&lt;00:00,  4.44it/s]
Calculating &#34;FLOPs&#34;...: 100%|| 2/2 [00:00&lt;00:00, 20.09it/s]
Gathering results from async objectives...: 0it [00:00, ?it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;ONNX Latency (ms)&#39;: array([0.00098251, 0.00145262]),
 &#39;FLOPs&#39;: array([4.07179530e+08, 4.75242634e+08])}
</pre></div></div>
</div>
<p>We can check if a model satisfies the constraints we added for the FLOPs objective by calling <code class="docutils literal notranslate"><span class="pre">SearchObjectives.validate_constraints(model_list,</span> <span class="pre">dataset_providers)</span></code> or <code class="docutils literal notranslate"><span class="pre">SearchObjectives.is_model_valid(ss.random_sample(),</span> <span class="pre">dataset_provider)</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span>

<span class="n">objectives</span><span class="o">.</span><span class="n">validate_constraints</span><span class="p">([</span><span class="n">m</span><span class="p">],</span> <span class="n">dataset_providers</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
({&#39;FLOPs&#39;: array([4.50410139e+09])}, array([], dtype=int64))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">objectives</span><span class="o">.</span><span class="n">is_model_valid</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">dataset_provider</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
False
</pre></div></div>
</div>
<p>By default, all objective and constraints evaluations are cached to prevent spending resources in the same architecture twice.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The evaluation cached is built</span>
<span class="c1"># using the tuple (obj_name, archid, dataset provider name, budget)</span>
<span class="n">objectives</span><span class="o">.</span><span class="n">cache</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{(&#39;ONNX Latency (ms)&#39;, &#39;(8, 3, 64)&#39;, &#39;NoneType&#39;, None): 0.0009825120214372873,
 (&#39;ONNX Latency (ms)&#39;, &#39;(7, 7, 32)&#39;, &#39;NoneType&#39;, None): 0.001452620994920532,
 (&#39;FLOPs&#39;, &#39;(8, 3, 64)&#39;, &#39;NoneType&#39;, None): 407179530,
 (&#39;FLOPs&#39;, &#39;(7, 7, 32)&#39;, &#39;NoneType&#39;, None): 475242634,
 (&#39;FLOPs&#39;, &#39;(8, 5, 128)&#39;, &#39;NoneType&#39;, None): 4504101386}
</pre></div></div>
</div>
<p>Caching can be disabled setting <code class="docutils literal notranslate"><span class="pre">SearchObjectives(cache_objective_evaluation=False)</span></code>.</p>
<p>Now, lets add the partial training objective we created before</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">objectives</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span>
    <span class="s1">&#39;Partial training Validation Accuracy (1 epoch)&#39;</span><span class="p">,</span>
    <span class="n">RayParallelEvaluator</span><span class="p">(</span>
        <span class="n">PartialTrainingValAccuracy</span><span class="p">(</span><span class="n">training_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">),</span>
        <span class="n">num_gpus</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="c1"># 2 jobs per gpu available</span>
        <span class="n">max_calls</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">),</span>
    <span class="n">higher_is_better</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">compute_intensive</span><span class="o">=</span><span class="kc">True</span> <span class="c1"># This is a compute intensive evaluator</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Expensive objectives can be evaluated using <code class="docutils literal notranslate"><span class="pre">SearchObjectives.eval_expensive_objs(model_list,</span> <span class="pre">dataset_providers)</span></code></p>
<p>Alternatively, all objectives (expensive and cheap) can also be evaluated using <code class="docutils literal notranslate"><span class="pre">SearchObjectives.eval_all_objs</span></code>.</p>
</section>
<section id="Adding-extra-constraints">
<h3>Adding extra constraints<a class="headerlink" href="#Adding-extra-constraints" title="Permalink to this headline">#</a></h3>
<p>Besides the constraint parameter from cheap objectives, it is also possible to add extra constraints that are not search objectives (and thus should not be optimized by NAS algorithms).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">archai.discrete_search.evaluators.pt_profiler</span> <span class="kn">import</span> <span class="n">TorchNumParameters</span>

<span class="n">objectives</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span>
    <span class="s1">&#39;Number of parameters&#39;</span><span class="p">,</span>
    <span class="n">TorchNumParameters</span><span class="p">(),</span>
    <span class="n">constraint</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">objectives</span><span class="o">.</span><span class="n">validate_constraints</span><span class="p">([</span><span class="n">m</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
({&#39;Number of parameters&#39;: array([2874762.]), &#39;FLOPs&#39;: array([4.50410139e+09])},
 array([], dtype=int64))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">objectives</span><span class="o">.</span><span class="n">is_model_valid</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
False
</pre></div></div>
</div>
</section>
</section>
<section id="Using-a-search-algorithm">
<h2>Using a search algorithm<a class="headerlink" href="#Using-a-search-algorithm" title="Permalink to this headline">#</a></h2>
<p>Now that we know how to create and use search objectives, we can finally use a search algorithm do to Neural Architecture Search!</p>
<section id="Example:-EvolutionParetoSearch">
<h3>Example: <code class="docutils literal notranslate"><span class="pre">EvolutionParetoSearch</span></code><a class="headerlink" href="#Example:-EvolutionParetoSearch" title="Permalink to this headline">#</a></h3>
<p>Lets start with an evolutionary-based search algorithm</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">archai.discrete_search.algos.evolution_pareto</span> <span class="kn">import</span> <span class="n">EvolutionParetoSearch</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">EvolutionParetoSearch</span><span class="p">(</span>
    <span class="n">ss</span><span class="p">,</span> <span class="n">objectives</span><span class="p">,</span> <span class="n">dataset_provider</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;./out_evo&#39;</span><span class="p">,</span>
    <span class="n">num_iters</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">num_crossovers</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">mutations_per_parent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">max_unseen_population</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_SKIP</span>
<span class="n">search_results</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">search</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
13:56 Using 10 random architectures as the initial population
13:56 starting evolution pareto iter 0
13:56 iter 0: calculating search objectives [&#39;ONNX Latency (ms)&#39;, &#39;FLOPs&#39;, &#39;Partial training Validation Accuracy (1 epoch)&#39;] for 10 models
13:57 iter 0: updating the pareto
13:57 iter 0: found 7 members
13:57 iter 0: chose 7 parents
Mutating parents: 100%|| 7/7 [00:00&lt;00:00, 25.16it/s]
13:57 iter 0: mutation yielded 12 new models
13:57 iter 0: crossover yielded 1 new models
13:57 iter 0: total unseen population 18
13:57 iter 0: total unseen population after `max_unseen_population` restriction 10
13:57 starting evolution pareto iter 1
13:57 iter 1: calculating search objectives [&#39;ONNX Latency (ms)&#39;, &#39;FLOPs&#39;, &#39;Partial training Validation Accuracy (1 epoch)&#39;] for 10 models
13:58 iter 1: updating the pareto
13:58 iter 1: found 12 members
13:58 iter 1: chose 12 parents
Mutating parents: 100%|| 12/12 [00:00&lt;00:00, 12.74it/s]
13:58 iter 1: mutation yielded 15 new models
13:58 iter 1: crossover yielded 0 new models
13:58 iter 1: total unseen population 20
13:58 iter 1: total unseen population after `max_unseen_population` restriction 10
13:58 starting evolution pareto iter 2
13:58 iter 2: calculating search objectives [&#39;ONNX Latency (ms)&#39;, &#39;FLOPs&#39;, &#39;Partial training Validation Accuracy (1 epoch)&#39;] for 10 models
13:59 iter 2: updating the pareto
13:59 iter 2: found 18 members
13:59 iter 2: chose 18 parents
Mutating parents: 100%|| 18/18 [00:01&lt;00:00, 15.72it/s]
13:59 iter 2: mutation yielded 18 new models
13:59 iter 2: crossover yielded 1 new models
13:59 iter 2: total unseen population 24
13:59 iter 2: total unseen population after `max_unseen_population` restriction 10
13:59 starting evolution pareto iter 3
13:59 iter 3: calculating search objectives [&#39;ONNX Latency (ms)&#39;, &#39;FLOPs&#39;, &#39;Partial training Validation Accuracy (1 epoch)&#39;] for 10 models
14:00 iter 3: updating the pareto
14:00 iter 3: found 20 members
14:00 iter 3: chose 20 parents
Mutating parents: 100%|| 20/20 [00:00&lt;00:00, 29.05it/s]
14:00 iter 3: mutation yielded 21 new models
14:00 iter 3: crossover yielded 2 new models
14:00 iter 3: total unseen population 28
14:00 iter 3: total unseen population after `max_unseen_population` restriction 10
14:00 starting evolution pareto iter 4
14:00 iter 4: calculating search objectives [&#39;ONNX Latency (ms)&#39;, &#39;FLOPs&#39;, &#39;Partial training Validation Accuracy (1 epoch)&#39;] for 10 models
14:01 iter 4: updating the pareto
14:01 iter 4: found 24 members
14:01 iter 4: chose 24 parents
Mutating parents: 100%|| 24/24 [00:00&lt;00:00, 24.93it/s]
14:01 iter 4: mutation yielded 17 new models
14:01 iter 4: crossover yielded 1 new models
14:01 iter 4: total unseen population 23
14:01 iter 4: total unseen population after `max_unseen_population` restriction 10
</pre></div></div>
</div>
<p>By default all algorithms will save the final pareto architectures <code class="docutils literal notranslate"><span class="pre">{output_dir}/pareto_models_iter_*/</span></code>, pareto evolution plots <code class="docutils literal notranslate"><span class="pre">pareto_*.png</span></code> and search state tables with all the results <code class="docutils literal notranslate"><span class="pre">{output_dir}/search_state_*.csv</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_SKIP</span>
<span class="o">!</span>ls<span class="w"> </span>./out_evo
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
log.log
pareto_FLOPs_vs_Partial_training_Validation_Accuracy_1_epoch.png
pareto_models_iter_1
pareto_models_iter_2
pareto_models_iter_3
pareto_models_iter_4
pareto_models_iter_5
pareto_ONNX_Latency_ms_vs_FLOPs.png
pareto_ONNX_Latency_ms_vs_Partial_training_Validation_Accuracy_1_epoch.png
search_state_1.csv
search_state_2.csv
search_state_3.csv
search_state_4.csv
search_state_5.csv
</pre></div></div>
</div>
<p>It is also possible to get information from the <code class="docutils literal notranslate"><span class="pre">search_results</span></code> object directly:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_SKIP</span>
<span class="n">search_results</span><span class="o">.</span><span class="n">plot_2d_pareto_evolution</span><span class="p">((</span><span class="s1">&#39;ONNX Latency (ms)&#39;</span><span class="p">,</span> <span class="s1">&#39;Partial training Validation Accuracy (1 epoch)&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../../_images/getting_started_notebooks_discrete_search_algos_61_0.png" src="../../../_images/getting_started_notebooks_discrete_search_algos_61_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_SKIP</span>
<span class="n">search_results</span><span class="o">.</span><span class="n">get_search_state_df</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;is_pareto&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Partial training Validation Accuracy (1 epoch)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>archid</th>
      <th>Partial training Validation Accuracy (1 epoch)</th>
      <th>ONNX Latency (ms)</th>
      <th>FLOPs</th>
      <th>parent</th>
      <th>parents</th>
      <th>iteration_num</th>
      <th>Search walltime (hours)</th>
      <th>is_pareto</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>46</th>
      <td>(1, 3, 64)</td>
      <td>0.264</td>
      <td>0.000239</td>
      <td>706762.0</td>
      <td>(1, 7, 128)</td>
      <td>None</td>
      <td>4</td>
      <td>0.086072</td>
      <td>True</td>
    </tr>
    <tr>
      <th>10</th>
      <td>(1, 5, 32)</td>
      <td>0.274</td>
      <td>0.000251</td>
      <td>754794.0</td>
      <td>(1, 5, 128)</td>
      <td>None</td>
      <td>1</td>
      <td>0.032674</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(1, 7, 32)</td>
      <td>0.310</td>
      <td>0.000208</td>
      <td>1356906.0</td>
      <td>None</td>
      <td>None</td>
      <td>0</td>
      <td>0.016957</td>
      <td>True</td>
    </tr>
    <tr>
      <th>35</th>
      <td>(1, 7, 64)</td>
      <td>0.326</td>
      <td>0.000236</td>
      <td>2713802.0</td>
      <td>(9, 3, 64)</td>
      <td>None</td>
      <td>3</td>
      <td>0.070278</td>
      <td>True</td>
    </tr>
    <tr>
      <th>7</th>
      <td>(1, 5, 128)</td>
      <td>0.335</td>
      <td>0.000296</td>
      <td>3019146.0</td>
      <td>None</td>
      <td>None</td>
      <td>0</td>
      <td>0.016957</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>(1, 7, 128)</td>
      <td>0.385</td>
      <td>0.000249</td>
      <td>5427594.0</td>
      <td>None</td>
      <td>None</td>
      <td>0</td>
      <td>0.016957</td>
      <td>True</td>
    </tr>
    <tr>
      <th>39</th>
      <td>(2, 3, 32)</td>
      <td>0.456</td>
      <td>0.000285</td>
      <td>7679082.0</td>
      <td>(9, 3, 32)</td>
      <td>None</td>
      <td>3</td>
      <td>0.070278</td>
      <td>True</td>
    </tr>
    <tr>
      <th>48</th>
      <td>(2, 3, 64)</td>
      <td>0.569</td>
      <td>0.000370</td>
      <td>29808842.0</td>
      <td>(2, 3, 32)</td>
      <td>None</td>
      <td>4</td>
      <td>0.086072</td>
      <td>True</td>
    </tr>
    <tr>
      <th>15</th>
      <td>(3, 3, 32)</td>
      <td>0.710</td>
      <td>0.000445</td>
      <td>15004778.0</td>
      <td>(6, 3, 32)</td>
      <td>None</td>
      <td>1</td>
      <td>0.032674</td>
      <td>True</td>
    </tr>
    <tr>
      <th>22</th>
      <td>(4, 3, 32)</td>
      <td>0.829</td>
      <td>0.000490</td>
      <td>22330474.0</td>
      <td>(6, 3, 32)</td>
      <td>None</td>
      <td>2</td>
      <td>0.052575</td>
      <td>True</td>
    </tr>
    <tr>
      <th>21</th>
      <td>(2, 7, 32)</td>
      <td>0.886</td>
      <td>0.000458</td>
      <td>40795242.0</td>
      <td>(9, 7, 32)</td>
      <td>None</td>
      <td>2</td>
      <td>0.052575</td>
      <td>True</td>
    </tr>
    <tr>
      <th>31</th>
      <td>(5, 3, 32)</td>
      <td>0.922</td>
      <td>0.000627</td>
      <td>29656170.0</td>
      <td>(4, 3, 32)</td>
      <td>None</td>
      <td>3</td>
      <td>0.070278</td>
      <td>True</td>
    </tr>
    <tr>
      <th>26</th>
      <td>(3, 5, 32)</td>
      <td>0.946</td>
      <td>0.000479</td>
      <td>41096298.0</td>
      <td>(3, 3, 32)</td>
      <td>None</td>
      <td>2</td>
      <td>0.052575</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(6, 3, 32)</td>
      <td>0.949</td>
      <td>0.000722</td>
      <td>36981866.0</td>
      <td>None</td>
      <td>None</td>
      <td>0</td>
      <td>0.016957</td>
      <td>True</td>
    </tr>
    <tr>
      <th>29</th>
      <td>(7, 3, 32)</td>
      <td>0.956</td>
      <td>0.000851</td>
      <td>44307562.0</td>
      <td>(9, 3, 32)</td>
      <td>None</td>
      <td>2</td>
      <td>0.052575</td>
      <td>True</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(4, 5, 32)</td>
      <td>0.974</td>
      <td>0.000551</td>
      <td>61267050.0</td>
      <td>None</td>
      <td>None</td>
      <td>0</td>
      <td>0.016957</td>
      <td>True</td>
    </tr>
    <tr>
      <th>49</th>
      <td>(8, 3, 32)</td>
      <td>0.975</td>
      <td>0.000872</td>
      <td>51633258.0</td>
      <td>(9, 3, 32)</td>
      <td>None</td>
      <td>4</td>
      <td>0.086072</td>
      <td>True</td>
    </tr>
    <tr>
      <th>28</th>
      <td>(6, 5, 32)</td>
      <td>0.975</td>
      <td>0.000726</td>
      <td>101608554.0</td>
      <td>None</td>
      <td>None</td>
      <td>2</td>
      <td>0.052575</td>
      <td>True</td>
    </tr>
    <tr>
      <th>44</th>
      <td>(7, 5, 32)</td>
      <td>0.980</td>
      <td>0.000860</td>
      <td>121779306.0</td>
      <td>(6, 5, 32)</td>
      <td>None</td>
      <td>4</td>
      <td>0.086072</td>
      <td>True</td>
    </tr>
    <tr>
      <th>30</th>
      <td>(10, 3, 32)</td>
      <td>0.983</td>
      <td>0.001035</td>
      <td>66284650.0</td>
      <td>(10, 5, 32)</td>
      <td>None</td>
      <td>3</td>
      <td>0.070278</td>
      <td>True</td>
    </tr>
    <tr>
      <th>6</th>
      <td>(4, 5, 64)</td>
      <td>0.986</td>
      <td>0.000885</td>
      <td>242956490.0</td>
      <td>None</td>
      <td>None</td>
      <td>0</td>
      <td>0.016957</td>
      <td>True</td>
    </tr>
    <tr>
      <th>40</th>
      <td>(8, 5, 32)</td>
      <td>0.987</td>
      <td>0.000919</td>
      <td>141950058.0</td>
      <td>(6, 5, 32)</td>
      <td>None</td>
      <td>4</td>
      <td>0.086072</td>
      <td>True</td>
    </tr>
    <tr>
      <th>25</th>
      <td>(10, 5, 32)</td>
      <td>0.988</td>
      <td>0.001160</td>
      <td>182291562.0</td>
      <td>None</td>
      <td>None</td>
      <td>2</td>
      <td>0.052575</td>
      <td>True</td>
    </tr>
    <tr>
      <th>20</th>
      <td>(9, 3, 64)</td>
      <td>0.991</td>
      <td>0.001337</td>
      <td>233523402.0</td>
      <td>(9, 3, 32)</td>
      <td>None</td>
      <td>2</td>
      <td>0.052575</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Since our search space is also compatible with Bayesian Optimization algorithms, lets try more sophisticated algorithm like MO-BANANAS.</p>
<p>MO-BANANAS will progressively train a surrogate model based on the data gathered during search. This surrogate model will be used to predict the result of expensive objective function evaluations and will try to determine what are the best possible architectures according to the surrogate model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">archai.discrete_search.algos.bananas</span> <span class="kn">import</span> <span class="n">MoBananasSearch</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">algo2</span> <span class="o">=</span> <span class="n">MoBananasSearch</span><span class="p">(</span>
    <span class="n">ss</span><span class="p">,</span> <span class="n">objectives</span><span class="p">,</span> <span class="n">dataset_provider</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;./out_bananas&#39;</span><span class="p">,</span>
    <span class="n">num_iters</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">mutations_per_parent</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">num_candidates</span><span class="o">=</span><span class="mi">20</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_SKIP</span>
<span class="n">search_results2</span> <span class="o">=</span> <span class="n">algo2</span><span class="o">.</span><span class="n">search</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
14:01 Starting iteration 0
14:01 Evaluating objectives for 10 architectures
14:02 Updating surrogate model...
Training DNN Ensemble...: 100%|| 5/5 [00:26&lt;00:00,  5.39s/it]
/home/pkauffmann/archai/archai/discrete_search/utils/multi_objective.py:53: VisibleDeprecationWarning: Creating an ndarray from ragged nested sequences (which is a list-or-tuple of lists-or-tuples-or ndarrays with different lengths or shapes) is deprecated. If you meant to do this, you must specify &#39;dtype=object&#39; when creating the ndarray.
  frontiers = np.array(
14:02 Generating mutations for 10 parent architectures...
14:02 Found 36 new architectures satisfying constraints.
14:02 Predicting [&#39;Partial training Validation Accuracy (1 epoch)&#39;] for new architectures using surrogate model
14:02 Calculating cheap objectives {&#39;ONNX Latency (ms)&#39;: {&#39;objective&#39;: &lt;archai.discrete_search.evaluators.onnx_model.AvgOnnxLatency object at 0x7fd1fc88c760&gt;, &#39;higher_is_better&#39;: False, &#39;constraint&#39;: None}, &#39;FLOPs&#39;: {&#39;objective&#39;: &lt;archai.discrete_search.evaluators.torch_model.TensorwatchStat object at 0x7fd1fc88c700&gt;, &#39;higher_is_better&#39;: False, &#39;constraint&#39;: (0.0, 1000000000.0)}} for new architectures
14:02 Best 20 candidate architectures were selected for the next iteration
14:02 Starting iteration 1
14:02 Evaluating objectives for 20 architectures
14:03 Updating surrogate model...
Training DNN Ensemble...: 100%|| 5/5 [00:27&lt;00:00,  5.42s/it]
/home/pkauffmann/archai/archai/discrete_search/utils/multi_objective.py:53: VisibleDeprecationWarning: Creating an ndarray from ragged nested sequences (which is a list-or-tuple of lists-or-tuples-or ndarrays with different lengths or shapes) is deprecated. If you meant to do this, you must specify &#39;dtype=object&#39; when creating the ndarray.
  frontiers = np.array(
14:04 Generating mutations for 10 parent architectures...
14:04 Found 26 new architectures satisfying constraints.
14:04 Predicting [&#39;Partial training Validation Accuracy (1 epoch)&#39;] for new architectures using surrogate model
14:04 Calculating cheap objectives {&#39;ONNX Latency (ms)&#39;: {&#39;objective&#39;: &lt;archai.discrete_search.evaluators.onnx_model.AvgOnnxLatency object at 0x7fd1fc88c760&gt;, &#39;higher_is_better&#39;: False, &#39;constraint&#39;: None}, &#39;FLOPs&#39;: {&#39;objective&#39;: &lt;archai.discrete_search.evaluators.torch_model.TensorwatchStat object at 0x7fd1fc88c700&gt;, &#39;higher_is_better&#39;: False, &#39;constraint&#39;: (0.0, 1000000000.0)}} for new architectures
14:04 Best 20 candidate architectures were selected for the next iteration
14:04 Starting iteration 2
14:04 Evaluating objectives for 20 architectures
14:05 Updating surrogate model...
Training DNN Ensemble...: 100%|| 5/5 [00:26&lt;00:00,  5.40s/it]
/home/pkauffmann/archai/archai/discrete_search/utils/multi_objective.py:53: VisibleDeprecationWarning: Creating an ndarray from ragged nested sequences (which is a list-or-tuple of lists-or-tuples-or ndarrays with different lengths or shapes) is deprecated. If you meant to do this, you must specify &#39;dtype=object&#39; when creating the ndarray.
  frontiers = np.array(
14:05 Generating mutations for 10 parent architectures...
14:05 Found 6 new architectures satisfying constraints.
14:05 Predicting [&#39;Partial training Validation Accuracy (1 epoch)&#39;] for new architectures using surrogate model
14:05 Calculating cheap objectives {&#39;ONNX Latency (ms)&#39;: {&#39;objective&#39;: &lt;archai.discrete_search.evaluators.onnx_model.AvgOnnxLatency object at 0x7fd1fc88c760&gt;, &#39;higher_is_better&#39;: False, &#39;constraint&#39;: None}, &#39;FLOPs&#39;: {&#39;objective&#39;: &lt;archai.discrete_search.evaluators.torch_model.TensorwatchStat object at 0x7fd1fc88c700&gt;, &#39;higher_is_better&#39;: False, &#39;constraint&#39;: (0.0, 1000000000.0)}} for new architectures
14:05 Best 20 candidate architectures were selected for the next iteration
14:05 Starting iteration 3
14:05 Evaluating objectives for 6 architectures
14:06 Updating surrogate model...
Training DNN Ensemble...: 100%|| 5/5 [00:26&lt;00:00,  5.31s/it]
/home/pkauffmann/archai/archai/discrete_search/utils/multi_objective.py:53: VisibleDeprecationWarning: Creating an ndarray from ragged nested sequences (which is a list-or-tuple of lists-or-tuples-or ndarrays with different lengths or shapes) is deprecated. If you meant to do this, you must specify &#39;dtype=object&#39; when creating the ndarray.
  frontiers = np.array(
14:06 Generating mutations for 10 parent architectures...
14:06 Found 1 new architectures satisfying constraints.
14:06 Predicting [&#39;Partial training Validation Accuracy (1 epoch)&#39;] for new architectures using surrogate model
14:06 Calculating cheap objectives {&#39;ONNX Latency (ms)&#39;: {&#39;objective&#39;: &lt;archai.discrete_search.evaluators.onnx_model.AvgOnnxLatency object at 0x7fd1fc88c760&gt;, &#39;higher_is_better&#39;: False, &#39;constraint&#39;: None}, &#39;FLOPs&#39;: {&#39;objective&#39;: &lt;archai.discrete_search.evaluators.torch_model.TensorwatchStat object at 0x7fd1fc88c700&gt;, &#39;higher_is_better&#39;: False, &#39;constraint&#39;: (0.0, 1000000000.0)}} for new architectures
14:06 Best 20 candidate architectures were selected for the next iteration
14:06 Starting iteration 4
14:06 Evaluating objectives for 1 architectures
14:06 Updating surrogate model...
Training DNN Ensemble...: 100%|| 5/5 [00:26&lt;00:00,  5.26s/it]
/home/pkauffmann/archai/archai/discrete_search/utils/multi_objective.py:53: VisibleDeprecationWarning: Creating an ndarray from ragged nested sequences (which is a list-or-tuple of lists-or-tuples-or ndarrays with different lengths or shapes) is deprecated. If you meant to do this, you must specify &#39;dtype=object&#39; when creating the ndarray.
  frontiers = np.array(
14:07 Generating mutations for 10 parent architectures...
14:07 Found 3 new architectures satisfying constraints.
14:07 Predicting [&#39;Partial training Validation Accuracy (1 epoch)&#39;] for new architectures using surrogate model
14:07 Calculating cheap objectives {&#39;ONNX Latency (ms)&#39;: {&#39;objective&#39;: &lt;archai.discrete_search.evaluators.onnx_model.AvgOnnxLatency object at 0x7fd1fc88c760&gt;, &#39;higher_is_better&#39;: False, &#39;constraint&#39;: None}, &#39;FLOPs&#39;: {&#39;objective&#39;: &lt;archai.discrete_search.evaluators.torch_model.TensorwatchStat object at 0x7fd1fc88c700&gt;, &#39;higher_is_better&#39;: False, &#39;constraint&#39;: (0.0, 1000000000.0)}} for new architectures
14:07 Best 20 candidate architectures were selected for the next iteration
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_SKIP</span>
<span class="o">!</span>ls<span class="w"> </span>./out_bananas
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
log.log
pareto_FLOPs_vs_Partial_training_Validation_Accuracy_1_epoch.png
pareto_ONNX_Latency_ms_vs_FLOPs.png
pareto_ONNX_Latency_ms_vs_Partial_training_Validation_Accuracy_1_epoch.png
search_state_0.csv
search_state_1.csv
search_state_2.csv
search_state_3.csv
search_state_4.csv
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_SKIP</span>
<span class="n">search_results2</span><span class="o">.</span><span class="n">plot_2d_pareto_evolution</span><span class="p">((</span><span class="s1">&#39;ONNX Latency (ms)&#39;</span><span class="p">,</span> <span class="s1">&#39;Partial training Validation Accuracy (1 epoch)&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../../_images/getting_started_notebooks_discrete_search_algos_68_0.png" src="../../../_images/getting_started_notebooks_discrete_search_algos_68_0.png" />
</div>
</div>
<p>MO-BANANAS will also save the predictive mean and variance of the expensive objectives during that iteration .</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NBVAL_SKIP</span>
<span class="n">search_results2</span><span class="o">.</span><span class="n">get_search_state_df</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;is_pareto&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Partial training Validation Accuracy (1 epoch)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>archid</th>
      <th>Partial training Validation Accuracy (1 epoch)</th>
      <th>ONNX Latency (ms)</th>
      <th>FLOPs</th>
      <th>iteration_num</th>
      <th>Predicted Partial training Validation Accuracy (1 epoch) mean</th>
      <th>Predicted Partial training Validation Accuracy (1 epoch) var</th>
      <th>Search walltime (hours)</th>
      <th>is_pareto</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>37</th>
      <td>(1, 3, 32)</td>
      <td>0.248</td>
      <td>0.000254</td>
      <td>353386.0</td>
      <td>2</td>
      <td>0.248418</td>
      <td>2.047968e-03</td>
      <td>0.059447</td>
      <td>True</td>
    </tr>
    <tr>
      <th>16</th>
      <td>(1, 3, 64)</td>
      <td>0.264</td>
      <td>0.000239</td>
      <td>706762.0</td>
      <td>1</td>
      <td>0.520867</td>
      <td>2.725258e-04</td>
      <td>0.035050</td>
      <td>True</td>
    </tr>
    <tr>
      <th>10</th>
      <td>(1, 5, 32)</td>
      <td>0.274</td>
      <td>0.000251</td>
      <td>754794.0</td>
      <td>1</td>
      <td>0.524827</td>
      <td>2.408193e-03</td>
      <td>0.035050</td>
      <td>True</td>
    </tr>
    <tr>
      <th>19</th>
      <td>(1, 7, 32)</td>
      <td>0.310</td>
      <td>0.000208</td>
      <td>1356906.0</td>
      <td>1</td>
      <td>0.750090</td>
      <td>2.623198e-04</td>
      <td>0.035050</td>
      <td>True</td>
    </tr>
    <tr>
      <th>26</th>
      <td>(1, 7, 64)</td>
      <td>0.326</td>
      <td>0.000236</td>
      <td>2713802.0</td>
      <td>1</td>
      <td>0.558949</td>
      <td>1.281874e-03</td>
      <td>0.035050</td>
      <td>True</td>
    </tr>
    <tr>
      <th>32</th>
      <td>(1, 5, 128)</td>
      <td>0.335</td>
      <td>0.000296</td>
      <td>3019146.0</td>
      <td>2</td>
      <td>0.305024</td>
      <td>7.075308e-04</td>
      <td>0.059447</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>(1, 7, 128)</td>
      <td>0.385</td>
      <td>0.000249</td>
      <td>5427594.0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.009741</td>
      <td>True</td>
    </tr>
    <tr>
      <th>36</th>
      <td>(2, 3, 32)</td>
      <td>0.456</td>
      <td>0.000285</td>
      <td>7679082.0</td>
      <td>2</td>
      <td>0.459846</td>
      <td>1.940939e-03</td>
      <td>0.059447</td>
      <td>True</td>
    </tr>
    <tr>
      <th>28</th>
      <td>(2, 3, 64)</td>
      <td>0.569</td>
      <td>0.000370</td>
      <td>29808842.0</td>
      <td>1</td>
      <td>0.693631</td>
      <td>3.133334e-05</td>
      <td>0.035050</td>
      <td>True</td>
    </tr>
    <tr>
      <th>35</th>
      <td>(2, 5, 32)</td>
      <td>0.666</td>
      <td>0.000389</td>
      <td>20925546.0</td>
      <td>2</td>
      <td>0.607475</td>
      <td>8.238424e-04</td>
      <td>0.059447</td>
      <td>True</td>
    </tr>
    <tr>
      <th>33</th>
      <td>(3, 3, 32)</td>
      <td>0.710</td>
      <td>0.000445</td>
      <td>15004778.0</td>
      <td>2</td>
      <td>0.679987</td>
      <td>1.583403e-03</td>
      <td>0.059447</td>
      <td>True</td>
    </tr>
    <tr>
      <th>12</th>
      <td>(4, 3, 32)</td>
      <td>0.829</td>
      <td>0.000490</td>
      <td>22330474.0</td>
      <td>1</td>
      <td>0.939183</td>
      <td>1.354675e-04</td>
      <td>0.035050</td>
      <td>True</td>
    </tr>
    <tr>
      <th>7</th>
      <td>(2, 7, 32)</td>
      <td>0.886</td>
      <td>0.000458</td>
      <td>40795242.0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.009741</td>
      <td>True</td>
    </tr>
    <tr>
      <th>15</th>
      <td>(5, 3, 32)</td>
      <td>0.922</td>
      <td>0.000627</td>
      <td>29656170.0</td>
      <td>1</td>
      <td>0.945611</td>
      <td>8.060229e-06</td>
      <td>0.035050</td>
      <td>True</td>
    </tr>
    <tr>
      <th>21</th>
      <td>(3, 5, 32)</td>
      <td>0.946</td>
      <td>0.000479</td>
      <td>41096298.0</td>
      <td>1</td>
      <td>0.842660</td>
      <td>5.665877e-04</td>
      <td>0.035050</td>
      <td>True</td>
    </tr>
    <tr>
      <th>0</th>
      <td>(6, 3, 32)</td>
      <td>0.949</td>
      <td>0.000722</td>
      <td>36981866.0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.009741</td>
      <td>True</td>
    </tr>
    <tr>
      <th>39</th>
      <td>(7, 3, 32)</td>
      <td>0.956</td>
      <td>0.000851</td>
      <td>44307562.0</td>
      <td>2</td>
      <td>0.963334</td>
      <td>4.732862e-07</td>
      <td>0.059447</td>
      <td>True</td>
    </tr>
    <tr>
      <th>6</th>
      <td>(4, 5, 32)</td>
      <td>0.974</td>
      <td>0.000551</td>
      <td>61267050.0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.009741</td>
      <td>True</td>
    </tr>
    <tr>
      <th>23</th>
      <td>(8, 3, 32)</td>
      <td>0.975</td>
      <td>0.000872</td>
      <td>51633258.0</td>
      <td>1</td>
      <td>0.969070</td>
      <td>5.998997e-05</td>
      <td>0.035050</td>
      <td>True</td>
    </tr>
    <tr>
      <th>22</th>
      <td>(6, 5, 32)</td>
      <td>0.975</td>
      <td>0.000726</td>
      <td>101608554.0</td>
      <td>1</td>
      <td>0.974126</td>
      <td>5.820624e-05</td>
      <td>0.035050</td>
      <td>True</td>
    </tr>
    <tr>
      <th>34</th>
      <td>(7, 5, 32)</td>
      <td>0.980</td>
      <td>0.000860</td>
      <td>121779306.0</td>
      <td>2</td>
      <td>0.980158</td>
      <td>6.198977e-07</td>
      <td>0.059447</td>
      <td>True</td>
    </tr>
    <tr>
      <th>40</th>
      <td>(10, 3, 32)</td>
      <td>0.983</td>
      <td>0.001035</td>
      <td>66284650.0</td>
      <td>2</td>
      <td>0.994888</td>
      <td>3.606799e-06</td>
      <td>0.059447</td>
      <td>True</td>
    </tr>
    <tr>
      <th>50</th>
      <td>(6, 3, 64)</td>
      <td>0.983</td>
      <td>0.000895</td>
      <td>146217162.0</td>
      <td>3</td>
      <td>0.976682</td>
      <td>7.886449e-07</td>
      <td>0.079053</td>
      <td>True</td>
    </tr>
    <tr>
      <th>44</th>
      <td>(4, 5, 64)</td>
      <td>0.986</td>
      <td>0.000885</td>
      <td>242956490.0</td>
      <td>2</td>
      <td>0.961790</td>
      <td>4.393400e-05</td>
      <td>0.059447</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(8, 5, 32)</td>
      <td>0.987</td>
      <td>0.000919</td>
      <td>141950058.0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.009741</td>
      <td>True</td>
    </tr>
    <tr>
      <th>31</th>
      <td>(10, 5, 32)</td>
      <td>0.988</td>
      <td>0.001160</td>
      <td>182291562.0</td>
      <td>2</td>
      <td>0.996126</td>
      <td>6.905550e-06</td>
      <td>0.059447</td>
      <td>True</td>
    </tr>
    <tr>
      <th>38</th>
      <td>(9, 3, 64)</td>
      <td>0.991</td>
      <td>0.001337</td>
      <td>233523402.0</td>
      <td>2</td>
      <td>1.008927</td>
      <td>1.038860e-04</td>
      <td>0.059447</td>
      <td>True</td>
    </tr>
    <tr>
      <th>30</th>
      <td>(10, 3, 64)</td>
      <td>0.991</td>
      <td>0.001333</td>
      <td>262625482.0</td>
      <td>2</td>
      <td>1.019735</td>
      <td>1.448977e-04</td>
      <td>0.059447</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="evaluators.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Evaluators</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="config_search.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Config Search Spaces</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Microsoft<br/>
  
      &copy; Copyright 2023.<br/>
    Last updated on Feb 07, 2023.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>