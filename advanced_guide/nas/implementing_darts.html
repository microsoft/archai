
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Implementing DARTS &#8212; Archai</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Computer Vision" href="../cv.html" />
    <link rel="prev" title="Petridish" href="petridish.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../getting_started/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../getting_started/quick_start.html">
   Quick Start
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../getting_started/package_structure.html">
   Package Structure
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Basic Guide
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../basic_guide/tutorial.html">
   30-Minute Tutorial
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../basic_guide/notebooks.html">
   Notebooks
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../basic_guide/notebooks/discrete_search.html">
     Discrete Search
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../basic_guide/notebooks/discrete_search/search_space.html">
       Search Spaces
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../basic_guide/notebooks/discrete_search/search_algos.html">
       Search Algorithms
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../basic_guide/notebooks/discrete_search/config_search.html">
       Config Search
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../basic_guide/notebooks/cv.html">
     Computer Vision
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../basic_guide/notebooks/nlp.html">
     Natural Language Processing
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../basic_guide/examples_scripts.html">
   Examples &amp; Scripts
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Advanced Guide
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../nas.html">
   Neural Architecture Search
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="available_algorithms.html">
     Available Algorithms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="petridish.html">
     Petridish
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Implementing DARTS
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../cv.html">
   Computer Vision
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../nlp.html">
   Natural Language Processing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../nlp/training.html">
     Training
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../nlp/evaluation.html">
     Evaluation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../nlp/onnx.html">
     ONNX
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../nlp/quantization.html">
     Quantization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../large_scale_training.html">
   Large-Scale Training
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../large_scale_training/deepspeed.html">
     DeepSpeed
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../large_scale_training/fsdp.html">
     Fully Shared Data Parallel (FSDP)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../devops.html">
   DevOps
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../devops/azure.html">
     Azure
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contributing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../contributing/first_contribution.html">
   First Time Contributor
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../contributing/documentation.html">
   Documentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../contributing/unitary_tests.html">
   Unitary Tests
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Support
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../support/faq.html">
   Frequently Asked Questions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../support/contact.html">
   Contact
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../support/copyright.html">
   Copyright
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../reference/api.html">
   API
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../reference/api/archai.algos.html">
     Algorithms
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.algos.darts.html">
       DARTS
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.algos.didarts.html">
       DiDARTS
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.algos.divnas.html">
       DivNAS
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.algos.gumbelsoftmax.html">
       Gumbel-Softmax
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.algos.manual.html">
       Manual
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.algos.nasbench101.html">
       NasBench-101
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.algos.petridish.html">
       Petridish
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.algos.random.html">
       Random
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.algos.xnas.html">
       XNAS
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../reference/api/archai.common.html">
     Common Packages
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../reference/api/archai.cv.html">
     Computer Vision
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../reference/api/archai.cv.datasets.html">
       Datasets
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
      <label for="toctree-checkbox-10">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.cv.datasets.providers.html">
         Providers
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.cv.datasets.transforms.html">
         Transforms
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../reference/api/archai.cv.models.html">
       Models
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
      <label for="toctree-checkbox-11">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.cv.models.shakeshake.html">
         ShakeShake
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../reference/api/archai.discrete_search.html">
     Discrete Search
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.discrete_search.algos.html">
       Search algorithms
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.discrete_search.api.html">
       Discrete Search API
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.discrete_search.datasets.html">
       Datasets
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.discrete_search.objectives.html">
       Bultin search objectives
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.discrete_search.predictors.html">
       Predictors
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.discrete_search.search_spaces.html">
       Bultin Discrete Search Spaces
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../reference/api/archai.nas.html">
     Neural Architecture Search
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../reference/api/archai.nlp.html">
     Natural Language Processing
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
    <label for="toctree-checkbox-13">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../reference/api/archai.nlp.datasets.html">
       Datasets
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
      <label for="toctree-checkbox-14">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.nlp.datasets.hf.html">
         Hugging Face
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.nlp.datasets.nvidia.html">
         NVIDIA
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../reference/api/archai.nlp.eval.html">
       Evaluation
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
      <label for="toctree-checkbox-15">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.nlp.eval.harness.html">
         Harness
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.nlp.eval.profiler.html">
         Profiler
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.nlp.eval.text_predict.html">
         Text Predict
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.nlp.objectives.html">
       Objectives
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../reference/api/archai.nlp.onnx.html">
       ONNX
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
      <label for="toctree-checkbox-16">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.nlp.onnx.config_utils.html">
         Configuration Utilities
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.nlp.onnx.optimization_utils.html">
         Optimization Utilities
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../reference/api/archai.nlp.quantization.html">
       Quantization
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../reference/api/archai.nlp.search_spaces.html">
       Search Spaces
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
      <label for="toctree-checkbox-17">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.nlp.search_spaces.transformer_flex.html">
         Transformer-Flex
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../reference/api/archai.nlp.trainers.html">
       Trainers
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
      <label for="toctree-checkbox-18">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.nlp.trainers.hf.html">
         Hugging Face
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../reference/api/archai.nlp.trainers.nvidia.html">
         NVIDIA
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/roadmap.html">
   Roadmap
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reference/changelog.html">
   Changelog
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/microsoft/archai"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/microsoft/archai/issues/new?title=Issue%20on%20page%20%2Fadvanced_guide/nas/implementing_darts.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/microsoft/archai/edit/master/advanced_guide/nas/implementing_darts.rst"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Sections
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mixedop">
   MixedOp
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modeldescbuilder">
   ModelDescBuilder
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#trainer">
   Trainer
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#putting-all-together">
   Putting All Together
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Implementing DARTS</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Sections </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mixedop">
   MixedOp
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modeldescbuilder">
   ModelDescBuilder
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#trainer">
   Trainer
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#putting-all-together">
   Putting All Together
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="implementing-darts">
<h1>Implementing DARTS<a class="headerlink" href="#implementing-darts" title="Permalink to this headline">#</a></h1>
<p>DARTS is a differentiable architecture search algorithm. In this document, we will describe how to implement DARTS in Archai as an example. Note that this algorithm is already implemented and can be found in <a class="reference external" href="https://github.com/microsoft/archai/tree/main/algos/darts">algos/darts</a>.</p>
<p>To implement DARTS, we will first create the <code class="docutils literal notranslate"><span class="pre">MixedOp</span></code> operation that combines all available operations along with their architecture weights. We will then use the <code class="docutils literal notranslate"><span class="pre">MixedOp</span></code> to create a super network with all possible edges. To train this super network, we will override the <code class="docutils literal notranslate"><span class="pre">ArchTrainer</span></code> class and use a bi-level optimizer.</p>
<section id="mixedop">
<h2>MixedOp<a class="headerlink" href="#mixedop" title="Permalink to this headline">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">MixedOp</span></code> class is responsible for combining the output of all available operations, weighted by their architecture parameters. The <code class="docutils literal notranslate"><span class="pre">forward()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">MixedOp</span></code> class sums the output of the operations, using the softmax of the architecture parameters as weights:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MixedOp</span><span class="p">(</span><span class="n">Op</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">asm</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_alphas</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">op</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">op</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">asm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ops</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">MixedOp</span></code> class creates one architecture parameter for each primitive operation, and keeps them encapsulated within the <code class="docutils literal notranslate"><span class="pre">Op</span></code> class. The <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code> class only has a <code class="docutils literal notranslate"><span class="pre">parameters()</span></code> method to retrieve learned weights, and does not differentiate between architecture weights and regular weights. The <code class="docutils literal notranslate"><span class="pre">Op</span></code> class, however, allows us to separate these two types of parameters.</p>
<p>Another important method in the <code class="docutils literal notranslate"><span class="pre">MixedOp</span></code> class is the <code class="docutils literal notranslate"><span class="pre">finalize()</span></code> method, which chooses the top primitives by architecture weight and returns them:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MixedOp</span><span class="p">(</span><span class="n">Op</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">OpDesc</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
        <span class="c1"># return finalized op description and its weight</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="c1"># select except &#39;none&#39; op</span>
            <span class="n">val</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">topk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_alphas</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">desc</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ops</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">desc</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="modeldescbuilder">
<h2>ModelDescBuilder<a class="headerlink" href="#modeldescbuilder" title="Permalink to this headline">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">ModelDescBuilder</span></code> class is responsible for building the super network that the searcher will use. The <code class="docutils literal notranslate"><span class="pre">ModelDescBuilder</span></code> builds the model description in parts: first, the model stems, then each cell, and finally, the pooling and logits layers. Within each cell, we first build the cell stems, then the nodes and their edges, and finally, a layer called the “post op” that produces the output. Each of these steps is implemented in its own method, allowing for easy customization.</p>
<p>For DARTS, we just need to build nodes with <code class="docutils literal notranslate"><span class="pre">MixedOp</span></code> as edges. To do this, we override the <code class="docutils literal notranslate"><span class="pre">build_nodes()</span></code> method in the <code class="docutils literal notranslate"><span class="pre">DartsModelDescBuilder</span></code> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DartsModelDescBuilder</span><span class="p">(</span><span class="n">ModelDescBuilder</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">build_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stem_shapes</span><span class="p">:</span><span class="n">TensorShapes</span><span class="p">,</span>
                    <span class="n">conf_cell</span><span class="p">:</span><span class="n">Config</span><span class="p">,</span>
                    <span class="n">cell_index</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">cell_type</span><span class="p">:</span><span class="n">CellType</span><span class="p">,</span>
                    <span class="n">node_count</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
                    <span class="n">in_shape</span><span class="p">:</span><span class="n">TensorShape</span><span class="p">,</span> <span class="n">out_shape</span><span class="p">:</span><span class="n">TensorShape</span><span class="p">)</span> \
                        <span class="o">-&gt;</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorShapes</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">NodeDesc</span><span class="p">]]:</span>

        <span class="c1"># is this cell reduction</span>
        <span class="n">reduction</span> <span class="o">=</span> <span class="p">(</span><span class="n">cell_type</span><span class="o">==</span><span class="n">CellType</span><span class="o">.</span><span class="n">Reduction</span><span class="p">)</span>

        <span class="c1"># create nodes list</span>
        <span class="n">nodes</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="n">NodeDesc</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[]</span>

        <span class="c1"># input and output channels for each node</span>
        <span class="n">conv_params</span> <span class="o">=</span> <span class="n">ConvMacroParams</span><span class="p">(</span><span class="n">in_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">out_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># for each noce we will create NodeDesc object</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">node_count</span><span class="p">):</span>
            <span class="c1"># for each node we have incoming edges</span>
            <span class="n">edges</span><span class="o">=</span><span class="p">[]</span>
            <span class="c1"># each node connects back to all previous nodes and s0 and s1 states</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">):</span>
                <span class="c1"># create MixedOp for each edge</span>
                <span class="n">op_desc</span> <span class="o">=</span> <span class="n">OpDesc</span><span class="p">(</span><span class="s1">&#39;mixed_op&#39;</span><span class="p">,</span>
                                    <span class="n">params</span><span class="o">=</span><span class="p">{</span>
                                        <span class="c1"># in/out channels for the edhe</span>
                                        <span class="s1">&#39;conv&#39;</span><span class="p">:</span> <span class="n">conv_params</span><span class="p">,</span>
                                        <span class="c1"># if reduction cell than use stride=2</span>
                                        <span class="c1"># for the stems</span>
                                        <span class="s1">&#39;stride&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">reduction</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">1</span>
                                    <span class="p">},</span>
                                    <span class="c1"># MixedOp only takes one input</span>
                                    <span class="n">in_len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1"># Edge description specifies op and where its input(s) comes from</span>
                <span class="n">edge</span> <span class="o">=</span> <span class="n">EdgeDesc</span><span class="p">(</span><span class="n">op_desc</span><span class="p">,</span> <span class="n">input_ids</span><span class="o">=</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>

            <span class="c1"># add the node in our collection</span>
            <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NodeDesc</span><span class="p">(</span><span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="p">,</span> <span class="n">conv_params</span><span class="o">=</span><span class="n">conv_params</span><span class="p">))</span>

        <span class="c1"># we need to return output shapes for each node which is same as input</span>
        <span class="n">out_shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">out_shape</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span>  <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">node_count</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">out_shapes</span><span class="p">,</span> <span class="n">nodes</span>
</pre></div>
</div>
<p>The parameters of this method indicate the expected input and output shapes for each node, as well as the cell type indicating whether it is a regular or reduction cell. The core of the method simply creates the <code class="docutils literal notranslate"><span class="pre">NodeDesc</span></code> instances to represent each node.</p>
</section>
<section id="trainer">
<h2>Trainer<a class="headerlink" href="#trainer" title="Permalink to this headline">#</a></h2>
<p>To perform a search, DARTS uses a bi-level optimization algorithm. To implement this, it is necessary to separate the regular weights from the architecture weights. The architecture weights are then trained using the bi-level optimizer. This can be easily done by taking advantage of the “hooks” provided by the trainer. These include the <code class="docutils literal notranslate"><span class="pre">pre_fit()</span></code> and <code class="docutils literal notranslate"><span class="pre">post_fit()</span></code> hooks, which are executed before and after the code for the <code class="docutils literal notranslate"><span class="pre">fit()</span></code> method. In the <code class="docutils literal notranslate"><span class="pre">pre_fit()</span></code> hook, the <code class="docutils literal notranslate"><span class="pre">BilevelOptimizer</span></code> class is initialized:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BilevelArchTrainer</span><span class="p">(</span><span class="n">ArchTrainer</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">pre_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_loaders</span><span class="p">:</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoaders</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pre_fit</span><span class="p">(</span><span class="n">data_loaders</span><span class="p">)</span>

        <span class="c1"># get config params for bi-level optimizer</span>
        <span class="n">w_momentum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conf_w_optim</span><span class="p">[</span><span class="s1">&#39;momentum&#39;</span><span class="p">]</span>
        <span class="n">w_decay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conf_w_optim</span><span class="p">[</span><span class="s1">&#39;decay&#39;</span><span class="p">]</span>
        <span class="n">lossfn</span> <span class="o">=</span> <span class="n">ml_utils</span><span class="o">.</span><span class="n">get_lossfn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conf_w_lossfn</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_device</span><span class="p">())</span>

        <span class="c1"># create bi-level optimizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bilevel_optim</span> <span class="o">=</span> <span class="n">BilevelOptimizer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conf_alpha_optim</span><span class="p">,</span>
                                                <span class="n">w_momentum</span><span class="p">,</span>
                                                <span class="n">w_decay</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">lossfn</span><span class="p">)</span>
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">pre_step()</span></code> hook, a step is run on the <code class="docutils literal notranslate"><span class="pre">BilevelOptimizer</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BilevelArchTrainer</span><span class="p">(</span><span class="n">ArchTrainer</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">pre_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pre_step</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># get the validation dataset for bi-level optimizer</span>
        <span class="n">x_val</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_valid_iter</span><span class="p">)</span>

        <span class="c1"># get regular optimizer</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_optimizer</span><span class="p">()</span>

        <span class="c1"># update alphas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bilevel_optim</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="putting-all-together">
<h2>Putting All Together<a class="headerlink" href="#putting-all-together" title="Permalink to this headline">#</a></h2>
<p>Once the custom <code class="docutils literal notranslate"><span class="pre">Trainer</span></code> and <code class="docutils literal notranslate"><span class="pre">ModelDescBuilder</span></code> classes have been created for DARTS, they must be specified to Archai through a class derived from <code class="docutils literal notranslate"><span class="pre">ExperimentRunner.</span></code> This is accomplished by overriding the <code class="docutils literal notranslate"><span class="pre">model_desc_builder</span></code> and <code class="docutils literal notranslate"><span class="pre">trainer_class</span></code> methods to specify the custom classes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DartsExperimentRunner</span><span class="p">(</span><span class="n">ExperimentRunner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">model_desc_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">DartsModelDescBuilder</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">DartsModelDescBuilder</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">trainer_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">TArchTrainer</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">BilevelArchTrainer</span>
</pre></div>
</div>
<p>Finally, the algorithm name and <code class="docutils literal notranslate"><span class="pre">DartsExperimentRunner</span></code> must be added to <code class="docutils literal notranslate"><span class="pre">main.py</span></code> so that they are utilized when <code class="docutils literal notranslate"><span class="pre">darts</span></code> is specified in the <code class="docutils literal notranslate"><span class="pre">--algos</span></code> switch.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="o">...</span>
    <span class="n">runner_types</span><span class="p">:</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="n">ExperimentRunner</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;darts&#39;</span><span class="p">:</span> <span class="n">DartsExperimentRunner</span><span class="p">,</span>
        <span class="o">...</span>
    <span class="p">}</span>
</pre></div>
</div>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="petridish.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Petridish</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../cv.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Computer Vision</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Microsoft<br/>
  
      &copy; Copyright 2023.<br/>
    Last updated on Jan 13, 2023.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>